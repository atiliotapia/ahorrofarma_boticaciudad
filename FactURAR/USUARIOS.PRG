PROCEDURE NUEVOS
**********************
** T-> HABILITADO   **
** F-> INHABILITADO **
**********************
USE USUARIOS.LIB
DEFI WIND USUARIO FROM 6,15 TO 19,65;
     CLOSE FLOAT GROW SHADOW COLOR SCHEME 15 TITLE 'NUEVOS   USUARIOS'

NOM=SPACE(10)
APP=SPACE(15)
APM=SPACE(15)
NIV=' '
COD='      '
CLAVE=SPACE(6)
SFAC='   '
SBOL='   '
ACTI WIND USUARIO
@1,2 SAY 'CODIGO    ¯' COLO 7+/2 GET COD PICT '999999' VALID CODCOD(COD) ERROR 'USUARIO YA FUE REGISTRADO' MESS 'C¢digo del Trabajador'
@2,2 SAY 'NOMBRE    ¯' COLO 7+/2 GET NOM
@3,2 SAY 'A.PATERNO ¯' COLO 7+/2 GET APP
@4,2 SAY 'A.MATERNO ¯' COLO 7+/2 GET APM VALID GENCLAV(APM) ERROR 'VUELVA A INGRESAR'
@5,2 SAY 'SERIE FACTURAS ¯' COLO 7+/2 GET SFAC PICT '999'
@6,2 SAY 'SERIE BOLETAS  ¯' COLO 7+/2 GET SBOL PICT '999'
@8,2 SAY 'NIVEL     ¯' COLO 7+/2 GET NIV PICT '9' VALID NIV $'12345' ERROR "[1]Supervisor  [2]Ventanilla  [3]Caja  [4]Regente ...."
@10,2 SAY "[1]Supervisor  [2]Ventanilla  [3]Caja" COLO R+/B
@11,2 SAY "[4]Regente [5]Cajero Vendedor " COLO R+/B
*ERROR "[1]SUPERVISOR [2]CAJA [3]FARMACIA [4]SIS"+CHR(13)+"[5]FARM.SIS [6]FARM.SUP. [7]SERV.SOCIAL"
READ
IF LASTKEY()=27
   CLOS DATA
   DEAC WIND USUARIO
   RETURN
ENDIF
DEAC WIND USUARIO
APPE BLAN
REPLA CODIGO WITH COD, C_L_A_V_E WITH CLAVE, NOMBRE WITH NOM, A_PATERNO WITH APP, A_MATERNO WITH APM, NIVEL WITH NIV
REPLA FEC_INICIO WITH DATE(), ESTADO WITH 'T', SERIE_FAC WITH SFAC, SERIE_BOL WITH SBOL
CLOS ALL
DEAC WIND USUARIOS



FUNCTION GENCLAV
PARAMETER A
IF A!=SPACE(15)
   TOT=LEN(LTRIM(RTRIM(NOM)))
   CLAVE=SUBS(NOM,TOT,1)
   TOT=LEN(LTRIM(RTRIM(APP)))
   CLAVE=CLAVE+SUBS(APP,TOT,1)
   TOT=LEN(LTRIM(RTRIM(APM)))
   CLAVE=CLAVE+SUBS(APM,TOT,1)
   NUMITERA=DAY(DATE())+VAL(SUBS(TIME(),4,2))
   FOR I=1 TO NUMITERA
       X=STR(RAND()*100000,5)
   ENDFOR
   X=SUBS(X,3,3)
   CLAVE=CLAVE+X
   WAIT WIND 'SU CLAVE ES :> '+CLAVE NOWA
   DECLA CLAV(6)
   FOR I=1 TO 6
      CLAV(I)=CHR(ASC(SUBS(CLAVE,I,1))+I*10)
   ENDFOR
   CLAVE=CLAV(1)
   FOR I=2 TO 6
      CLAVE=CLAVE+CLAV(I)
   ENDFOR
   RETURN .T.
  ELSE
   RETURN .F.
ENDIF   

FUNCTION CODCOD
PARAMETER A
LOCA FOR CODIGO=COD
IF FOUND()
   RETURN .F.
  ELSE
   RETURN .T.
ENDIF







PROCEDURE ELIMINAR 
USE USUARIOS.LIB
SET FILTER TO ESTADO='T'
DEFI POPU ELIMINA FROM 9,10 TO 16,70 PROM FIEL CODIGO+'  '+NOMBRE+A_PATERNO+A_MATERNO+DTOC(FEC_INICIO)+'  '+NIVEL SCRO TITL 'USUARIOS AUTORIZADOS' FOOT '< ENTER > Seleccionar' COLO SCHE 8
ON SELECTION POPU ELIMINA DO BORRAR
ACTI POPU ELIMINA
SET SAFE OFF
COPY TO C:\SIGEP\REPOXLS\USUARIOS TYPE XLS
SET SAFE ON
CLOS ALL
RETURN


PROCEDURE BORRAR
DEFI WIND USUARIO FROM 12,15 TO 14,65;
     CLOSE FLOAT GROW SHADOW COLOR SCHEME 4
ACTI WIND USUARIO
MOTIVAR=SPACE(20)
@0,4 SAY 'MOTIVO ¯>' GET MOTIVAR
READ
IF LAST()=27
   DEAC WIND USUARIO
   RETURN
ENDIF   
DEAC WIND USUARIO
REPLA MOTIVO WITH MOTIVAR, FEC_FINAL WITH DATE(), ESTADO WITH 'F'


