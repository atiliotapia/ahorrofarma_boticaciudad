****EN EL FICHERO FACTURA.DBF ****
****EL CAMPO FECHA REPRESENTA LA FECHA DE PAGO DE LA FACTURA****
****TODOS LOS PEDIDOS DEBEN SER FACTURADOS EL MISMO DIA DEL PEDIDO****
****EN EL FICHERO MEDICTDO.DBF ****
****EL CAMPO FECHA REPRESENTA LA FECHA DEL PEDIDO Y COINCIDIRA CON LA FECHA DE EMISION****
****EN EL CASO DE VENTAS AL CONTADO TODAS LAS FECHAS COINCIDEN****
DEFI WIND CONSULTA FROM 10,24 TO 14,56;
     CLOSE FLOAT GROW SHADOW DOUBLE
DEFI WIND MUESTRA FROM 0,2 TO 23,77;
     CLOSE FLOAT GROW SHADOW 
DEFI WIND AYUDAS FROM 22,7 TO 24,73;
     CLOSE FLOAT GROW SHADOW  COLOR SCHEME 6
RESP=" "     
REGRO=0
TIPO="M"
FECONS=SPACE(8)
PARTIDA=SPACE(30)
TOTAL=0
ACTI WIND AYUDAS
SET COLO TO RB/GR+ 
CLEA
SET COLO TO I
@0,21 SAY '<0> + <ENTER>  S A L I R'
ACTI WIND CONSULTA
SET COLO TO WR/B
@1,3 SAY 'NUMERO TICKET ¯>' GET  REGRO PICT '99999999'
*@1,36 SAY '-' GET  TIPO PICT '!A' 
READ
DEAC WIND CONSULTA
DEAC WIND AYUDAS
IF REGRO>0
   SELE A
      USE MEDITICK ALIAS MEDITICK
      SET ORDE TO NUM_TICKET
   SELE B
      USE MEDICINA ALIAS MEDICINA
      SET ORDE TO CODIGO
   SELE MEDITICK
   GO TOP
   SEEK REGRO
   IF FOUND() AND ESTADO=" " AND FECHA=DATE()
      *NOMPROD=NOMBRE
      ACTI WIND MUESTRA
      @0,17 SAY 'FICHERO REGISTRADOR DE VENTA DE MEDICINAS' COLO I
      @2,7  SAY 'NRO.TICKET : ' COLO BG+/B
      @2,41  SAY 'FECHA VENTA : ' COLO BG+/B
      *@3,2  SAY 'NOMBRE PACIENTE : ' COLO BG+/B     
      @3,51  SAY 'TIPO VTA:' COLO BG+/B
      @5,0  SAY 'CODIGO' COLO GR+/R
      @5,15 SAY 'DESCRIPCION' COLO GR+/R
      @5,49 SAY 'CANT.' COLO GR+/R
      @5,56  SAY 'PREC UNIT' COLO GR+/R
      @5,68  SAY 'TOTAL' COLO GR+/R
      @6,0 TO 6,73
      SET COLO TO WR/B
      @19,43 SAY 'TOTAL x FACTURAR :> '
      SET COLO TO GR+/B
      @2,21  SAY''+STR(REGRO,8)
      @2,56  SAY''+DTOC(FECHA)
      *@3,21  SAY''+NOMBRE
      @3,60 SAY 'CONTADO' COLO I
      Y=7
      DO WHILE !EOF()
         IF NUM_TICKET=REGRO AND ESTADO=" "
            @Y,0  SAY''+MEDICINA1 COLO W+/B
            SET RELA TO A->MEDICINA1 INTO B
            @Y,10 SAY''+SUBS(B->NOM_COMER,1,30) COLO W+/B
            @Y,42 SAY''+ SUBS(B->FORMA,1,3) COLO W+/B
            @Y,48 SAY''+STR(CANTID1,6,2) COLO W+/B
            @Y,54 SAY''+STR(PREC_UNI1,9,2) COLO W+/B
            @Y,63 SAY''+STR((CANTID1*PREC_UNI1),10,2) COLO W+/B
            TOTAL=TOTAL+(CANTID1*PREC_UNI1)
         ENDIF
         SKIP
         IF NUM_TICKET=REGRO
            Y=Y+1
           ELSE
            EXIT
         ENDIF
      ENDDO
      @19,63 SAY''+STR(TOTAL,10,2) COLO I
      RESP=" "
      @21,16 SAY 'Se realiz¢ el pago del TICKET (S/N) ?' GET RESP PICT "!A" VALID LETRA(RESP) COLO G+/B
      READ
      IF LAST()=27
         ELSE
          IF RESP="S"
             SELE MEDITICK
             SEEK REGRO
             IF FOUN()
                DO WHILE !EOF()
                   IF NUM_TICKET=REGRO AND ESTADO=" "
                      REPLA ESTADO WITH "C"
                   ENDIF
                   SKIP
                   IF NUM_TICKET=REGRO
                      Y=Y+1
                     ELSE
                      EXIT
                   ENDIF
                ENDDO
             ENDIF
          ENDIF
      ENDIF
      DEAC WIND MUESTRA
     ELSE     
      ACTI WIND CONSULTA
      SET BELL TO 4500,4
      ?CHR(7)
      SET BELL TO 500,2
      ?CHR(7)
      SET COLO TO WR/B*
      @0,4 SAY 'NUMERO TICKET NO EXISTE'
      @2,4 SAY 'O FUE ANULADO/VERIFICADO'
      WAIT''
      SET COLO TO WR/B
      DEAC WIND CONSULTA
   ENDIF
ENDIF
CLOSE ALL


FUNCTION FECHITA
PARAMETER A
IF DTOC(CTOD(A))='  /  /  '
   RETURN .F.
  ELSE
   RETURN .T.
ENDIF   


FUNCTION LETRA
PARAMETER A
IF A='S' .OR. A='N'
  RETURN .T.
 ELSE
  RETURN .F.
ENDIF  
