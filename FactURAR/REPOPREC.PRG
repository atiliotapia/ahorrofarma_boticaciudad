SET BELL TO 60,1
SET EXACT ON
SET NEAR ON
DEFI WIND BLANCO FROM 0,0 TO 24,79;
     CLOSE FLOAT GROW SHADOW COLOR B/B NONE
DEFI WIND TODO FROM 0,0 TO 24,79;
     CLOSE FLOAT GROW SHADOW COLOR B/B,GR/B,W/R,R/W FOOT '<PgUp> RETROCEDE    <PgDn> AVANZA   <F8> IMPRIME   <ESC> SALIR' 'Û'
DEFI WIND PREPARA FROM 10,20 TO 14,60;
     CLOSE FLOAT GROW SHADOW 
DEFI WIND AYUDAS FROM 22,7 TO 24,73;
     CLOSE FLOAT GROW SHADOW  COLOR SCHEME 6
DEFI WIND PEDII FROM 9,18 TO 16,55 DOUBLE
DEFI WIND TIPO FROM 9,25 TO 16,50 DOUBLE 
     
INES=0
DEAC WIND TODO
DEAC WIND AYUDAS
ACTI WIND AYUDAS
SET COLO TO RB/GR+ 
CLEA
SET COLO TO I
@0,14 SAY 'SELECCIONE EL  PERIODO DE PROCESO'
ACTI WIND PEDII
FIN=DATE()
@0,19 SAY '[ dd/mm/aa ]'
@5,2 SAY '  Fechas iguales para un d¡a  '
@1,4 SAY 'FECHA INICIAL:  ' GET FIN
READ
IF LASTKEY()=27
   DEAC WIND PEDII
   DEAC WIND AYUDAS
   RETURN
ENDIF   
*FIN=CTOD(FIN)
FFI=FIN
@3,4 SAY 'FECHA FINAL  :  ' GET FFI
READ
IF LASTKEY()=27
   DEAC WIND PEDII
   DEAC WIND AYUDAS
   RETURN
ENDIF   
*FFI=CTOD(FFI)
DEAC WIND PEDII
DO WHILE .T.
ACTI WIND AYUDAS
CLEA
@0,18 SAY '  < ESC >   PARA SALIR  '
ACTI WIND TIPO
SET COLO TO WR/B
CLEA
@0,2 SAY ' << L I S T A D O >> '
@2,6 PROM ' SERVICIO '
@4,6 PROM ' GENERAL  '
MENU TO PITO
IF LASTKEY()=27
   DEAC WIND TIPO
   CLOSE ALL
   DEAC WIND INGRESO
   DEAC WIND TITULO
   DEAC WIND TODO
   DEAC WIND AYUDAS
   DEAC WIND PREPARA
   SET NEAR OFF
   RETURN
ENDIF   
DO CASE
   CASE PITO=1
        DO PRECSERV
   CASE PITO=2
        DO TOTALIZA
ENDCASE
ENDDO   


PROCEDURE PRECSERV
STORE 0 TO TOTAL,EXONERA,TOTATE,TOTMED,TOTLAB,TOTRAD,TOTHOS,FACT,SERV
STORE 0 TO TOTAL1,EXONERA1,TOTATE1,TOTMED1,TOTLAB1,TOTRAD1,TOTHOS1,FACT1
STORE 0 TO TOTAL2,EXONERA2,TOTATE2,TOTMED2,TOTLAB2,TOTRAD2,TOTHOS2,FACT2
ACTI WIND AYUDAS
CLEA
@0,14 SAY 'INGRESE EL CODIGO DEL SERVICIO'
ACTI WIND PREPARA
SET COLO TO WR/B
CLEA
@1,4 SAY 'ELIJA SERVICIO :> ' GET SERV PICT '99' RANGE 1,99 ERROR 'CODIGO NO EXISTE'
READ
DEAC WIND PREPARA
USE SERVICIO NOUPDATE
SET ORDE TO 1
* INDE SERV
SEEK SERV
IF FOUND()
   NOM=NOMBRE
   ACTI WIND PREPARA
   SET COLO TO WR/B*
   CLEA
   @1,4 SAY 'ESPERE UN MOMENTO POR FAVOR ...'
   STORE 0 TO TOTAL,EXONERA,TOTATE,TOTMED,TOTLAB,TOTRAD,TOTHOS,FACT
   ACTI WIND AYUDAS
   @0,15 SAY 'PROCESANDO             PACIENTES'     
   USE PACIENTE NOUPDATE
   SET ORDE TO 3
   * INDE FALTA
   SEEK FIN
   DO WHILE .NOT. EOF()
      IF FECHA_ALTA>=(FIN) AND FECHA_ALTA<=(FFI) AND SERVICIO=SERV
         IF CONVENIO=0 AND FACTURA>0
            TOTLAB=TOTLAB+LABORATORI
            TOTRAD=TOTRAD+IMAGENES
            TOTATE=TOTATE+OTROS_ATEN+T_SALA
            TOTMED=TOTMED+M_MEDICO+B_MEDICINA+C_MEDICINA
            TOTHOS=TOTHOS+HOSPITAL
            EXONERA=EXONERA+MONTO_EXON
           ELSE
            IF CONVENIO>0
               TOTLAB1=TOTLAB1+LABORATORI
               TOTRAD1=TOTRAD1+IMAGENES
               TOTATE1=TOTATE1+OTROS_ATEN+T_SALA
               TOTMED1=TOTMED1+M_MEDICO+B_MEDICINA+C_MEDICINA
               TOTHOS1=TOTHOS1+HOSPITAL
               EXONERA1=EXONERA1+MONTO_EXON
               FACT1=FACT1+1
              ELSE
               TOTLAB2=TOTLAB2+LABORATORI
               TOTRAD2=TOTRAD2+IMAGENES
               TOTATE2=TOTATE2+OTROS_ATEN+T_SALA
               TOTMED2=TOTMED2+M_MEDICO+B_MEDICINA+C_MEDICINA
               TOTHOS2=TOTHOS2+HOSPITAL
               EXONERA2=EXONERA2+MONTO_EXON
               FACT2=FACT2+1
            ENDIF  
         ENDIF   
         FACT=FACT+1
         @0,26 SAY ''+STR(FACT,10)
      ENDIF
      SKIP
      IF FECHA_ALTA>(FFI)
         EXIT
      ENDIF   
   ENDDO   
   DO PANTALLA
ENDIF   
RETURN


PROCEDURE TOTALIZA
ACTI WIND PREPARA
SET COLO TO WR/B*
CLEA
@1,4 SAY 'ESPERE UN MOMENTO POR FAVOR ...'
STORE 0 TO TOTAL,EXONERA,TOTATE,TOTMED,TOTLAB,TOTRAD,TOTHOS,FACT
STORE 0 TO TOTAL1,EXONERA1,TOTATE1,TOTMED1,TOTLAB1,TOTRAD1,TOTHOS1,FACT1
STORE 0 TO TOTAL2,EXONERA2,TOTATE2,TOTMED2,TOTLAB2,TOTRAD2,TOTHOS2,FACT2
ACTI WIND AYUDAS
@0,15 SAY 'PROCESANDO             PACIENTES'  
USE PACIENTE NOUPDATE
SET ORDE TO 3
* INDE FALTA
SEEK FIN
DO WHILE .NOT. EOF()
   IF FECHA_ALTA>=(FIN) AND FECHA_ALTA<=(FFI)
   IF CONVENIO=0 AND FACTURA>0
      TOTLAB=TOTLAB+LABORATORI
      TOTRAD=TOTRAD+IMAGENES
      TOTATE=TOTATE+OTROS_ATEN+T_SALA
      TOTMED=TOTMED+M_MEDICO+B_MEDICINA+C_MEDICINA
      TOTHOS=TOTHOS+HOSPITAL
      EXONERA=EXONERA+MONTO_EXON
     ELSE
      IF CONVENIO>0
         TOTLAB1=TOTLAB1+LABORATORI
         TOTRAD1=TOTRAD1+IMAGENES
         TOTATE1=TOTATE1+OTROS_ATEN+T_SALA
         TOTMED1=TOTMED1+M_MEDICO+B_MEDICINA+C_MEDICINA
         TOTHOS1=TOTHOS1+HOSPITAL
         EXONERA1=EXONERA1+MONTO_EXON
         FACT1=FACT1+1
        ELSE
         TOTLAB2=TOTLAB2+LABORATORI
         TOTRAD2=TOTRAD2+IMAGENES
         TOTATE2=TOTATE2+OTROS_ATEN+T_SALA
         TOTMED2=TOTMED2+M_MEDICO+B_MEDICINA+C_MEDICINA
         TOTHOS2=TOTHOS2+HOSPITAL
         EXONERA2=EXONERA2+MONTO_EXON
         FACT2=FACT2+1
      ENDIF  
   ENDIF
   FACT=FACT+1
   @0,26 SAY ''+STR(FACT,10)
   ENDIF
   SKIP
   IF FECHA_ALTA>(FFI)
      EXIT
   ENDIF   
ENDDO   
DO PANTALLA
RETURN


PROCEDURE PANTALLA
DEAC WIND PREPARA
ACTI WIND BLANCO
ACTI WIND TODO
SET COLO TO B/W*
@0,27 SAY 'EGRESOS  D E  PACIENTES'
@4,29 SAY 'F A C T U R A D O S'
SET COLO TO R+/B
@1,24 SAY 'DEL :>'+DTOC(FIN)+'  AL :>'+DTOC(FFI)
SET COLO TO WR/B
IF PITO=1
   SET COLO TO WR/B
   @2,0 SAY 'SERVICIO :> '+SUBS(NOM,1,25)
ENDIF

@6,26 SAY 'LABORATORIO :> '+STR(TOTLAB,12,2)
@7,19 SAY 'DIAG. POR IMAGENES :> '+STR(TOTRAD,12,2)
@8,21 SAY 'OTRAS ATENCIONES :> '+STR(TOTATE,12,2)
@9,29 SAY 'FARMACIA :> '+STR(TOTMED,12,2)
@10,22 SAY 'HOSPITALIZACION :> '+STR(TOTHOS,12,2)
@11,26 SAY 'EXONERACION :> '+STR(EXONERA,12,2)
SET COLO TO I
@14,26 SAY 'MONTO TOTAL :> '+STR((TOTLAB+TOTRAD+TOTATE+TOTMED+TOTHOS-EXONERA),12,2)            
SET COLO TO WR/B
@18,25 SAY 'TOTAL ::> '+STR((FACT-FACT1-FACT2),10)+'   Pacientes'
SAVE WIND TODO TO PANT1
WAIT''

CLEA
SET COLO TO B/W*
@0,27 SAY 'EGRESOS  D E  PACIENTES'
@4,30 SAY 'C O N V E N I O S'
SET COLO TO R+/B
@1,24 SAY 'DEL :>'+DTOC(FIN)+'  AL :>'+DTOC(FFI)
SET COLO TO WR/B
IF PITO=1
   SET COLO TO WR/B
   @2,0 SAY 'SERVICIO :> '+SUBS(NOM,1,25)
ENDIF
@6,26 SAY 'LABORATORIO :> '+STR(TOTLAB1,12,2)
@7,19 SAY 'DIAG. POR IMAGENES :> '+STR(TOTRAD1,12,2)
@8,21 SAY 'OTRAS ATENCIONES :> '+STR(TOTATE1,12,2)
@9,29 SAY 'FARMACIA :> '+STR(TOTMED1,12,2)
@10,22 SAY 'HOSPITALIZACION :> '+STR(TOTHOS1,12,2)
@11,26 SAY 'EXONERACION :> '+STR(EXONERA1,12,2)
SET COLO TO I
@14,26 SAY 'MONTO TOTAL :> '+STR((TOTLAB1+TOTRAD1+TOTATE1+TOTMED1+TOTHOS1-EXONERA1),12,2)            
SET COLO TO WR/B
@18,25 SAY 'TOTAL ::> '+STR(FACT1,10)+'   Pacientes'
SAVE WIND TODO TO PANT2
WAIT''

CLEA
SET COLO TO B/W*
@0,27 SAY 'EGRESOS  D E  PACIENTES'
@4,30 SAY 'G A R A N T I A S'
SET COLO TO R+/B
@1,24 SAY 'DEL :>'+DTOC(FIN)+'  AL :>'+DTOC(FFI)
SET COLO TO WR/B
IF PITO=1
   SET COLO TO WR/B
   @2,0 SAY 'SERVICIO :> '+SUBS(NOM,1,25)
ENDIF
@6,26 SAY 'LABORATORIO :> '+STR(TOTLAB2,12,2)
@7,19 SAY 'DIAG. POR IMAGENES :> '+STR(TOTRAD2,12,2)
@8,21 SAY 'OTRAS ATENCIONES :> '+STR(TOTATE2,12,2)
@9,29 SAY 'FARMACIA :> '+STR(TOTMED2,12,2)
@10,22 SAY 'HOSPITALIZACION :> '+STR(TOTHOS2,12,2)
@11,26 SAY 'EXONERACION :> '+STR(EXONERA2,12,2)
SET COLO TO I
@14,26 SAY 'MONTO TOTAL :> '+STR((TOTLAB2+TOTRAD2+TOTATE2+TOTMED2+TOTHOS2-EXONERA2),12,2)            
SET COLO TO WR/B
@18,25 SAY 'TOTAL ::> '+STR(FACT2,10)+'   Pacientes'
SAVE WIND TODO TO PANT3
INES=3
ON KEY LABEL F8 DO IMPRIMA
ON KEY LABEL PGUP DO SUBE 
ON KEY LABEL PGDN DO BAJA 
SET ESCAPE ON
STORE .F. TO mexit
ON ESCAPE STORE .T. TO mexit
DO WHILE NOT mexit
   IF LASTKEY()!=-1 .AND. LASTKEY()!=-4
      CLEAR TYPEAHEAD
   ENDIF   
ENDDO
ON KEY LABEL PGDN
ON KEY LABEL PGUP
ON KEY LABEL F8
DEAC WIND TODO
DEAC WIND BLANCO
DELE FILE PANT1.WIN
DELE FILE PANT2.WIN
DELE FILE PANT3.WIN
RETURN



FUNCTION FECHA
PARAMETER A
IF DTOC(CTOD(A))!='  /  /  '
   RETURN .T.
  ELSE
   RETURN .F.
ENDIF    





PROCEDURE IMPRIMA
IF PRIN()
   SET DEVI TO PRIN
   DO CASE
      CASE INES=1
         @0,0 SAY CHR(15)
         @2,2 SAY ''+TITULO01
         @3,2 SAY '   HUANCAYO-PERU'   
         @4,0 SAY CHR(18)
         @6,27 SAY 'EGRESOS  D E  PACIENTES'
         @8,27 SAY '    HOSPITALIZADOS'
         @10,22 SAY 'DEL þ¯ '+DTOC(FIN)+'  AL þ¯ '+DTOC(FFI)
         IF PITO=1
            @12,1 SAY 'SERVICIO :> '+SUBS(NOM,1,25)
         ENDIF
         @15,29 SAY '*******************'
         @16,29 SAY 'F A C T U R A D O S'
         @16,29 SAY 'F A C T U R A D O S'
         @17,29 SAY '*******************'
         @20,26 SAY 'LABORATORIO :> '+STR(TOTLAB,12,2)
         @21,19 SAY 'DIAG. POR IMAGENES :> '+STR(TOTRAD,12,2)
         @22,21 SAY 'OTRAS ATENCIONES :> '+STR(TOTATE,12,2)
         @23,29 SAY 'FARMACIA :> '+STR(TOTMED,12,2)
         @24,22 SAY 'HOSPITALIZACION :> '+STR(TOTHOS,12,2)
         @25,26 SAY 'EXONERACION :> '+STR(EXONERA,12,2)
         @28,26 SAY 'MONTO TOTAL :> '+STR((TOTLAB+TOTRAD+TOTATE+TOTMED+TOTHOS-EXONERA),12,2)            
         @32,25 SAY 'TOTAL ::> '+STR((FACT-FACT1-FACT2),6)+'   Pacientes'
         EJECT

      CASE INES=2   
         @0,0 SAY CHR(15)
         @2,2 SAY ''+TITULO01
         @3,2 SAY '   HUANCAYO-PERU'   
         @4,0 SAY CHR(18)
         @6,27 SAY 'EGRESOS  D E  PACIENTES'
         @8,27 SAY '    HOSPITALIZADOS'
         @10,22 SAY 'DEL þ¯ '+DTOC(FIN)+'  AL þ¯ '+DTOC(FFI)
         IF PITO=1
            @12,1 SAY 'SERVICIO :> '+SUBS(NOM,1,25)
         ENDIF
         @15,29 SAY '*******************'   
         @16,30 SAY 'C O N V E N I O S'
         @16,30 SAY 'C O N V E N I O S'
         @17,29 SAY '*******************'
         @20,26 SAY 'LABORATORIO :> '+STR(TOTLAB1,12,2)
         @21,19 SAY 'DIAG. POR IMAGENES :> '+STR(TOTRAD1,12,2)
         @22,21 SAY 'OTRAS ATENCIONES :> '+STR(TOTATE1,12,2)
         @23,29 SAY 'FARMACIA :> '+STR(TOTMED1,12,2)
         @24,22 SAY 'HOSPITALIZACION :> '+STR(TOTHOS1,12,2)
         @25,26 SAY 'EXONERACION :> '+STR(EXONERA1,12,2)
         @28,26 SAY 'MONTO TOTAL :> '+STR((TOTLAB1+TOTRAD1+TOTATE1+TOTMED1+TOTHOS1-EXONERA1),12,2)            
         @32,25 SAY 'TOTAL ::> '+STR(FACT1,6)+'   Pacientes'
         EJECT      
      CASE INES=3   
         @0,0 SAY CHR(15)
         @2,2 SAY ''+TITULO01
         @3,2 SAY '   HUANCAYO-PERU'   
         @4,0 SAY CHR(18)
         @6,27 SAY 'EGRESOS  D E  PACIENTES'
         @8,27 SAY '    HOSPITALIZADOS'
         @10,22 SAY 'DEL þ¯ '+DTOC(FIN)+'  AL þ¯ '+DTOC(FFI)
         IF PITO=1
            @12,1 SAY 'SERVICIO :> '+SUBS(NOM,1,25)
         ENDIF
         @15,29 SAY '*******************'   
         @16,30 SAY 'G A R A N T I A S'
         @16,30 SAY 'G A R A N T I A S'  
         @17,29 SAY '*******************'
         @20,26 SAY 'LABORATORIO :> '+STR(TOTLAB2,12,2)
         @21,19 SAY 'DIAG. POR IMAGENES :> '+STR(TOTRAD2,12,2)
         @22,21 SAY 'OTRAS ATENCIONES :> '+STR(TOTATE2,12,2)
         @23,29 SAY 'FARMACIA :> '+STR(TOTMED2,12,2)
         @24,22 SAY 'HOSPITALIZACION :> '+STR(TOTHOS2,12,2)
         @25,26 SAY 'EXONERACION :> '+STR(EXONERA2,12,2)
         @28,26 SAY 'MONTO TOTAL :> '+STR((TOTLAB2+TOTRAD2+TOTATE2+TOTMED2+TOTHOS2-EXONERA2),12,2)            
         @32,25 SAY 'TOTAL ::> '+STR(FACT2,6)+'   Pacientes'
         EJECT
   ENDCASE
   SET DEVI TO SCREE
ENDIF   
RETURN





PROCEDURE SUBE
DO CASE
   CASE INES=2
        REST WIND TODO FROM PANT1
        INES=INES-1        
   CASE INES=3
        REST WIND TODO FROM PANT2
        INES=INES-1        
ENDCASE
RETURN

PROCEDURE BAJA
DO CASE
   CASE INES=1
        REST WIND TODO FROM PANT2
        INES=INES+1        
   CASE INES=2
        REST WIND TODO FROM PANT3
        INES=INES+1        
ENDCASE
RETURN
