SET ECHO OFF
SET TALK OFF
DEFI WIND PEDII FROM 9,18 TO 16,55 SHADOW
DEFI WIND CENSO FROM 1,0 TO 24,79 TITLE 'EXONERACIONES - PACIENTES HOSPITALIZADOS'
DEFI WIND TIPO FROM 9,25 TO 16,50 DOUBLE 
SET NEAR ON

FIN=DATE()
SELE A
     USE PACIENTE NOUPDATE
     SET ORDE TO FECHA_EXON
SELE B
     USE SERVICIO NOUPDATE
     SET ORDE TO CODIGO
SELE C
     USE USUARIOS.LIB ALIAS USUARIOS
     SET ORDE TO CODIGO
SELE A
ACTI WIND PEDII
@0,19 SAY '[ dd/mm/aaaa ]'
@5,2 SAY '  Fechas iguales para un d¡a  '
@1,4 SAY 'FECHA INICIAL:  ' GET FIN
READ
IF LASTKEY()=27
   DEAC WIND PEDII
   RETURN
ENDIF   
FFI=FIN
@3,4 SAY 'FECHA FINAL  :  ' GET FFI
READ
IF LASTKEY()=27
   DEAC WIND PEDII
   RETURN
ENDIF   
DEAC WIND PEDII
ACTI WIND CENSO
@0,0 SAY "PERIODO :> "+DTOC(FIN)+"-"+DTOC(FFI) COLO G+/B
SELE A
SEEK FIN
@1,0 SAY 'CUENTA           PACIENTE           FECHA  SERVICIO  TOTAL  EXONERAD  DIGITAD' COLO GR+/B
@2,0 SAY REPL('Í',78) COLO GR+/B
Y=3
TOTP=0
TOTT=0
TOTE=0
DO WHILE !EOF()
   SER=SERVICIO
   TOT=LABORATORI+IMAGENES+ECOGRAFIA+OTROS_ATEN+M_MEDICO+B_MEDICINA+C_MEDICINA+T_SALA+HOSPITAL
   SELE B
   SEEK SER
   SERVIC=NOMBRE
   SELE A
   IF FECHA_EXON>=FIN AND FECHA_EXON<=FFI AND MONTO_EXON>0
      @Y,0 SAY +STR(CUENTA_C,6)+' '+SUBS(NOMBRE,1,28)+' '+SUBS(DTOC(FECHA_EXON),1,5)+' '+SUBS(SERVIC,1,8)+' '+STR(TOT,8,2)+' '+STR(MONTO_EXON,8,2)+' '+DIGI_EXON
      Y=Y+1
      TOTP=TOTP+1
      TOTT=TOTT+TOT
      TOTE=TOTE+MONTO_EXON
      IF Y=20
         READ
	     IF LASTKEY()=27
		    DEAC WIND CENSO
		    RETURN
		 ENDIF   
         Y=3
         @3,0 CLEA TO 20,78
      ENDIF  
      IF FECHA_EXON>FFI
         EXIT 
      ENDIF   
   ENDIF
   SKIP
ENDDO
@20,0 SAY 'TOTALES -> '+STR(TOTP,5)+' Pacientes       CUENTA S/.'+STR(TOTT,9,2)+'    EXONERADO S/.'+STR(TOTE,9,2) COLO G/B
@21,0 SAY REPL('Û',78) COLO RB/B
@21,10 SAY 'F8-Imprime' COLO W/RB
@21,64 SAY 'ESC-Salir' COLO W/RB
@21,10 SAY 'F8' COLO GR+/RB
@21,64 SAY 'ESC' COLO GR+/RB
ON KEY LABEL F8 DO IMPRIME
SET ESCAPE ON
STORE .F. TO mexit
ON ESCAPE STORE .T. TO mexit
DO WHILE NOT mexit
   IF LASTKEY()!=-1 .AND. LASTKEY()!=-4
      CLEAR TYPEAHEAD
   ENDIF   
ENDDO
ON KEY LABEL F8
DEAC WIND CENSO
CLOS ALL
SET NEAR OFF
RETURN




FUNCTION FECHAS
PARAMETER FEC
FEC=CTOD(FEC)
IF DTOC(FEC)!='  /  /  '
   RETURN .T.
  ELSE
   RETURN .F. 
ENDIF



PROCEDURE IMPRIME
		SET DEVI TO PRINT
		@0,0 SAY CHR(15)
		Y=8
		X=0
		MONTEXON=0
		pg=1
		@1,26 SAY 'EXONERACIONES PACIENTES HOSPITALIZADOS  '+TITULO01
		@4,3 SAY 'PERIODO:> '+DTOC(FIN)+' - '+DTOC(FFI)
		@4,134 SAY 'Pg. '+STR(PG,2)
		@5,0 SAY +REPLI('ð',140)
		@6,1 SAY 'CTA.CTE.'
		@6,10 SAY 'HISTORIA'
		@6,26 SAY 'PACIENTE'
		@6,53 SAY 'FECHA ALTA'
		@6,66 SAY 'SERVICIO'
		@6,84 SAY 'CUENTA S/.'
		@6,96 SAY 'MONTO EXON'
		@6,108 SAY 'FECHA EXON'
		@6,124 SAY 'PERSONAL'
		@7,0 SAY +REPLI('ð',140)
        SELE A
        SEEK FIN
	   	DO WHILE !EOF()
		   SER=SERVICIO
		   SELE B
		   SEEK SER
		   SERVIC=NOMBRE
		   SELE A
		   IF FECHA_EXON>=FIN AND FECHA_EXON<=FFI AND MONTO_EXON>0
              TOT=LABORATORI+IMAGENES+ECOGRAFIA+OTROS_ATEN+M_MEDICO+B_MEDICINA+C_MEDICINA+T_SALA+HOSPITAL
              SET RELA TO DIGI_EXON INTO USUARIOS
              @Y,0 SAY +STR(CUENTA_C,7)+'   '+STR(HISTORIA,7)+'    '+NOMBRE+'  '+DTOC(FECHA_ALTA)+'   '+SUBS(SERVIC,1,15)+'  '+STR(TOT,10,2)+'   '+STR(MONTO_EXON,10,2)+'  '+DTOC(FECHA_EXON)+'  '+SUBS(USUARIOS.NOMBRE,1,8)+' '+SUBS(USUARIOS.A_PATERNO,1,10)
		      Y=Y+1
		      X=X+1
		      MONTEXON=MONTEXON+MONTO_EXON
	          IF Y=55
   	        	 EJECT
		         PG=PG+1
		         @1,26 SAY 'EXONERACIONES PACIENTES HOSPITALIZADOS  '+TITULO01
		         @4,3 SAY 'PERIODO:> '+DTOC(FIN)+' - '+DTOC(FFI)
		         @4,134 SAY 'Pg. '+STR(PG,2)
		         @5,0 SAY +REPLI('ð',140)
		         @6,1 SAY 'CTA.CTE.'
		         @6,10 SAY 'HISTORIA'
		         @6,26 SAY 'PACIENTE'
		         @6,53 SAY 'FECHA ALTA'
	         	 @6,66 SAY 'SERVICIO'
	          	 @6,84 SAY 'CUENTA S/.'
		         @6,96 SAY 'MONTO EXON'
		         @6,108 SAY 'FECHA EXON'
		         @6,124 SAY 'PERSONAL'
		         @7,0 SAY +REPLI('ð',140)
	   	         Y=8
	   	         IF LASTKEY()=27
	   			    EJECT
		            SET DEVI TO SCREE
    		        EXIT
                 ENDIF
        	  ENDIF   
        	  IF FECHA_EXON>FFI
          	     EXIT 
          	  ENDIF   
		   ENDIF
		   SKIP
		ENDDO
		@56,0 SAY +REPLI('-',140)
		@57,0 SAY 'TOTALES -> '+STR(TOTP,5)+' Pacientes                   CUENTA S/.'+STR(TOTT,9,2)+'                EXONERADO S/.'+STR(TOTE,9,2)
		@58,0 SAY +REPLI('-',140)
        EJECT
		SET DEVI TO SCRE
