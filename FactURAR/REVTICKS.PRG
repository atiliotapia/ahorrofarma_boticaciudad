SET DATE FRENCH
SET CONFIRM ON
SET BELL TO 60,1
SET ESCAPE OFF
SET EXACT ON
DEFI WIND TODO FROM 4,3 TO 20,76;
     NOCLOSE NOFLOAT NOGROW SHADOW COLOR G+/B
DEFI WIND PREPARA FROM 0,10 TO 3,70;
     NOCLOSE NOFLOAT NOGROW
DEFI WIND AVISO FROM 10,10 TO 14,70;
     NOCLOSE NOFLOAT NOGROW
DEFI WIND AYUDAS FROM 22,7 TO 24,73;
     CLOSE FLOAT GROW SHADOW  COLOR SCHEME 6
DEFI WIND PEDII FROM 9,18 TO 16,55 DOUBLE
MES=0
NOMMES=SPACE(10)
MESITO=SPACE(8)
DEAC WIND TODO
ACTI WIND AYUDAS
CLEA
SET COLO TO I
@0,14 SAY 'SELECCIONE EL  PERIODO DE PROCESO'
ACTI WIND PEDII
FIN=DATE()
@0,19 SAY '[ dd/mm/aaaa ]'
@5,2 SAY '  Fechas iguales para un d¡a  '
@1,4 SAY 'FECHA INICIAL:  ' GET FIN 
READ
IF LASTKEY()=27
   DEAC WIND PEDII
   DEAC WIND AYUDAS
   RETURN
ENDIF   
FFI=FIN
@3,4 SAY 'FECHA FINAL  :  ' GET FFI VALID FECHA(FFI,FIN) ERROR 'FECHA FINAL DEBE SER MAYOR QUE FECHA INICIAL'
READ
IF LASTKEY()=27
   DEAC WIND PEDII
   DEAC WIND AYUDAS
   RETURN
ENDIF   
CLOSE ALL
DEAC WIND PEDII
ACTI WIND AYUDAS
CLEA
*@0,10 SAY "F8-Imprimir reporte" COLO B/W
*@0,10 SAY "F8" COLO GR+/W
@0,20 SAY "DEL/SUPR - Anular pedido" COLO B/W
@0,20 SAY "DEL/SUPR" COLO GR+/W
SELE A
     USE MEDITICK ALIAS MEDITICK
     SET ORDE TO FECHA
SELE B
     USE FACTURA
     SET ORDE TO REGIREGI
SELE C
     USE MEDICINA ALIAS MEDICINA
     SET ORDE TO CODIGO

SELE MEDITICK
SET RELA TO MEDICINA1 INTO MEDICINA
*ON KEY LABEL F8 DO IMPRIMIR
ON KEY LABEL DEL DO ANULATIC
ACTI WIND PREPARA
SELE MEDICINA
EDIT FIEL NOM_COMER:H="NOMBRE",FORMA:H="FORMA" IN WIND PREPARA NOWA NODELETE NOMODIFY
ACTI WIND TODO
SELE MEDITICK
*SET FILTE TO FECHA>=FIN ADN FECHA<=FFI
SET FILTE TO REGISTRO=0
BROW FIEL FECHA:H="  FECHA",MEDICINA1:H="CODIGO",CANTID1:H="CANTIDAD",PREC_UNI1:H="  P.UNIT",TOTAL=CANTID1*PREC_UNI1:H="   TOTAL",ESTADO:H="ESTADO",DIGITADOR:H="DIGITA",HORA:H=" HORA" NOEDIT NOLINK NOMENU NOOPTIMIZE NOLGRID NORGRID IN WIND TODO TITLE "PRODUCTOS REGISTRADOS COMO TICKETS"
ON KEY LABEL DEL
*ON KEY LABEL F8
DEAC WIND TODO
DEAC WIND AYUDAS
DEAC WIND PREPARA
CLOS ALL




PROCEDURE ANULATIC
IF ESTADO=" " AND REGISTRO=0
   ACTI WIND AVISO
   @0,4 SAY '®® INGRESE CLAVE ¯¯'
   SET COLO TO N/N
   ACCE TO CLAV10
   SET COLO TO R/GB
   IF CLAV10='BORRATICK'
      CANTI=CANTID1
      COSTPROM=T_COSTO1
      REPLA ESTADO WITH "A", FECHA_ANUL WITH DATE(),HORA_ANUL WITH TIME(),DIGI_ANUL WITH CODUSU  
      SELE MEDICINA
      REPLA CANT_STOCK WITH CANT_STOCK+CANTI
      REPLA TOTAL_COMP WITH TOTAL_COMP+COSTPROM
      REPLA PREC_COMP WITH TOTAL_COMP/CANT_STOCK
      WAIT WIND "ANULADO" NOWA
     ELSE
      WAIT WIND "NO ESTA AUTORIZADO" NOWA
   ENDIF
   DEAC WIND AVISO
  ELSE
   WAIT WIND "REGISTRO YA FUE ANULADO O FACTURADO" NOWA
ENDIF
RETURN




FUNCTION FECHA
PARAMETER A,B
IF A>=B
   RETURN .T.
  ELSE
   RETURN .F.
ENDIF    
