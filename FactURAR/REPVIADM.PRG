DEFI WIND PREPARA FROM 11,20 TO 15,60;
     CLOSE FLOAT GROW SHADOW COLOR SCHEME 9

CLOS ALL
DELE FILE TMPRPVAD.DBF
CREA TABL TMPRPVAD (CODIGO N(6), NOMBRE C(30), I_CONS N(4), I_EMER N(4), I_HOSP N(4), INDICA C(1))

SELE 1
     USE PACISESS ALIAS PACISESS
     SET ORDE TO 3
SELE 2
     USE SERVICIOS ALIAS SERVICIOS
     SET ORDE TO 1
SELE 3
     USE TMPRPVAD
X=0
   
FIN=SPACE(8)
FFI=SPACE(8)
ACTI WIND PREPARA
@0,7 SAY 'FECHA INICIAL :>' COLO R/GB GET FIN PICT '99/99/99' VALID FECHAS(FIN) ERROR 'Fecha incorrecta'
@2,9 SAY 'FECHA FINAL :>' COLO R/GB GET FFI PICT '99/99/99' VALID FECHAS(FFI) ERROR 'Fecha incorrecta'
READ
IF LAST()=27
   DEAC WIND PREPARA
   CLOS ALL
   RETURN
ENDIF
DEAC WIND PREPARA
SELE 1
SEEK CTOD(FIN)
BROW
DO WHILE !EOF()
   IF (FECHA_ALTA)>=CTOD(FIN) AND (FECHA_ALTA)<=CTOD(FFI)
      SERV=SERVICIO
      SET RELA TO SERV INTO 2
      SELE 3
      LOCATE FOR CODIGO=SERV
      IF !FOUN()
         APPE BLAN
         REPLA CODIGO WITH SERV
         REPLA NOMBRE WITH B->NOMBRE
      ENDIF
      IF PACISESS.TIPO='A'
         IF PACISESS.VIA_ADM='C'
            REPLA I_CONS WITH I_CONS+1
           ELSE
            REPLA I_EMER WITH I_EMER+1
         ENDIF
        ELSE
         REPLA I_HOSP WITH I_HOSP+1
      ENDIF  
      SELE 1
   ENDIF
   SKIP
ENDDO
SELE 3
REPO FORM RPVIAADM PREV
CLOS ALL
DELE FILE TMPRPVAD.DBF
RETURN


FUNCTION FECHAS
PARAMETER A
IF DTOC(CTOD(A))!='  /  /  '
   RETURN .T.
  ELSE
   RETURN .F. 
ENDIF

