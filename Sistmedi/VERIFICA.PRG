SET ECHO OFF
SET TALK OFF

SELE A
USE X:\SISTEMA\FACTURAR\MEDICINA
SET ORDE TO CODIGO
SELE B
USE X:\SISTEMA\SISTMEDI\DATOS\MAESMEDI
SELE C
USE X:\SISTEMA\FACTURAR\MEDICTDO
SET FILTE TO ESTADO!="A"
SELE D
USE X:\SISTEMA\FACTURAR\MEDISESS
SELE E
USE X:\SISTEMA\FACTURAR\MEDISANI
SELE F
USE X:\SISTEMA\SISTMEDI\DATOS\INGRMEDI
X=0
*SET DEVI TO FILE C:\TXT.TXT
SELE A
GO TOP
DO WHILE !EOF()
   COD=CODIGO
   CAN=CANT_STOCK
   SELE MEDICTDO
   SUM ALL TO A CANTID1 FOR MEDICINA1=COD
   SUM ALL TO B CANTID2 FOR MEDICINA2=COD
   SUM ALL TO C CANTID3 FOR MEDICINA3=COD
   SUM ALL TO D CANTID4 FOR MEDICINA4=COD
   SUM ALL TO E CANTID5 FOR MEDICINA5=COD
   SELE MEDISESS
   SUM ALL TO F CANTIDAD1 FOR MEDICINA1=COD
   SELE MEDISANI
   SUM ALL TO G CANTIDAD1 FOR MEDICINA1=COD
   SELE INGRMEDI
   SUM ALL TO H I_CANTIDAD FOR CODIGO=COD
   SELE B
   LOCATE FOR CODIGO=COD
   IF (CAN+A+B+C+D+E+F+G-H)!=STOCK
      ?COD+STR(STOCK,12,2)+STR((CAN+A+B+C+D+E+F+G-H),12,2)+STR(CAN,10,2)+STR(A,10,2)+STR(B,10,2)+STR(C,10,2)+STR(D,10,2)+STR(E,10,2)+STR(F,10,2)+STR(G,10,2)-STR(H,10,2)
      CAN1=STOCK
      SELE A
      ?COD+STR(CANT_STOCK,12,2)+STR((CAN1-A-B-C-D-E-F-G+H),12,2)
      *REPLA CANT_STOCK WITH (CAN+A+B+C+D+E+F+G-H)
      X=X+1
   ENDIF
   SELE A
   SKIP
ENDDO
?X
SET DEVI TO SCRE