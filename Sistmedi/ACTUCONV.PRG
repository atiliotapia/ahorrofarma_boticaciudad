****FALTA VERIFICAR DEUDA PENDIENTE****
****DEBE ACTUALIZAR LA DEUDA PENDIENTE****
PARAMETERS A01,A02

****VERIFICANDO LOS DATOS DE DETACONV EN MEDICTDO****
SELECT FACTURA
SET ORDER TO SERFAC
SELECT MEDICTDO
SET ORDER TO REGISTRO
SELECT DETACONV
SET FILTER TO FECHA_EMIS>=A01 AND FECHA_EMIS<=A02 AND EMPTY(FECHA_CANC)
GO TOP
DO WHILE !EOF()
   M.CUENTA_C=CUENTA_C
   SERIEFAC=SERIE_FAC
   REGFAC=FACTURA
   FECHAFAC=FECHA_EMIS
   MTOFAC=MONTO
   SELECT FACTURA
   SEEK SERIEFAC+STR(REGFAC,8)
   IF FOUND()
      REGRO=REGISTRO
      SELECT MEDICTDO
      SEEK REGRO
      IF CUENTA_C=M.CUENTA_C
        ELSE
         SELECT DETACONV
         DELE
      ENDIF
     ELSE
      SELECT DETACONV
      DELE
   ENDIF
   SELECT DETACONV
   SKIP
ENDDO


****VERIFICANDO LOS DATOS DE MEDICTDO EN DETACONV****
SELECT MEDICTDO
SET ORDER TO FECHA
SELECT FACTURA
SET ORDE TO REGIREGI
SELECT DETACONV
SET ORDER TO CUENTA_C
SET NEAR ON
SELECT MEDICTDO
SEEK A01
DO WHILE !EOF()
   IF FECHA>=A01 AND FECHA<=A02
      REGRO=REGISTRO
      *FECHA_EMIS
      SELE FACTURA
      SEEK STR(REGRO,8)+"M"
      IF FOUND() AND EMPTY(FECHA)
         SERIEFAC=SERIE
         REGFAC=NUMERO
         DIGFAC=DIGITADOR
         HORAFAC=HORA
         FECHAFAC=FECHA_EMIS
         SELECT MEDICTDO
            M.CUENTA_C=CUENTA_C
            TIPOVTA=TIPO_VTA
            NOMPAC=NOMBRE
            DCTO=EXONERAR
            PREESPEC=REDONDEO
            
            CANT1=CANTID1
            CODMED1=MEDICINA1
            PRECMED1=PREC_UNI1
            PREC1=CANTID1*PREC_UNI1
            
            CANT2=CANTID2
            CODMED2=MEDICINA2
            PRECMED2=PREC_UNI2
            PREC2=CANTID2*PREC_UNI2
            
            CANT3=CANTID3
            CODMED3=MEDICINA3
            PRECMED3=PREC_UNI3
            PREC3=CANTID3*PREC_UNI3
            
            CANT4=CANTID4
            CODMED4=MEDICINA4
            PRECMED4=PREC_UNI4
            PREC4=CANTID4*PREC_UNI4
            
            CANT5=CANTID5
            CODMED5=MEDICINA5
            PRECMED5=PREC_UNI5
            PREC5=CANTID5*PREC_UNI5
            
            CANT6=CANTID6
            CODMED6=MEDICINA6
            PRECMED6=PREC_UNI6
            PREC6=CANTID6*PREC_UNI6
            
            CANT7=CANTID7
            CODMED7=MEDICINA7
            PRECMED7=PREC_UNI7
            PREC7=CANTID7*PREC_UNI7
            
            CANT8=CANTID8
            CODMED8=MEDICINA8
            PRECMED8=PREC_UNI8
            PREC8=CANTID8*PREC_UNI8
            
            CANT9=CANTID9
            CODMED9=MEDICINA9
            PRECMED9=PREC_UNI9
            PREC9=CANTID9*PREC_UNI9
            
            CANT10=CANTID10
            CODMED10=MEDICINA10
            PRECMED10=PREC_UNI10
            PREC10=CANTID10*PREC_UNI10
            
            DIGIVEND=DIGITADOR
            EXONERA=EXONERAR
            
            SUBTOT=CANTID1*PREC_UNI1+CANTID2*PREC_UNI2+CANTID3*PREC_UNI3+CANTID4*PREC_UNI4+CANTID5*PREC_UNI5+CANTID6*PREC_UNI6+CANTID7*PREC_UNI7+CANTID8*PREC_UNI8+CANTID9*PREC_UNI9+CANTID10*PREC_UNI10
            TOTDE=SUBTOT*EXONERAR/100
            TOTAL=SUBTOT-TOTDE
            
            IF VAL(STR(TOTAL,12,1))!=TOTAL
               PREESPEC=VAL(STR(TOTAL,12,1))-TOTAL
               TOTAL=VAL(STR(TOTAL,12,1))
              ELSE
               PREESPEC=0
            ENDIF
         SELECT DETACONV
         LOCATE FOR CUENTA_C=M.CUENTA_C AND FACTURA=REGFAC
         IF !FOUND()
            APPE BLAN
            REPLA CUENTA_C WITH M.CUENTA_C, FECHA_EMIS WITH FECHAFAC, SERIE_FAC WITH SERIEFAC, FACTURA WITH REGFAC
            REPLA MONTO WITH TOTAL, DIGITADOR WITH DIGFAC, HORA WITH HORAFAC
         ENDIF
      ENDIF
   ENDIF
   SELECT MEDICTDO
   SKIP
ENDDO
SELECT DETACONV
SET FILTER TO 

